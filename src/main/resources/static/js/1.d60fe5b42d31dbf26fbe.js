webpackJsonp([1],{"8xfg":function(e,t,n){"use strict";var i={props:{msg:String,columns:Array,rows:Array,actions:Array,costmerStyle:Object},data:function(){return{selectedByIndex:[]}},methods:{getContainerClass:function(){var e="table-container";return(this.msg||!this.rows||this.rows.length<=0)&&(e+=" no-data-container"),e},allSelectedChange:function(e){this.selectedByIndex=this.rows.map(function(t){return e})},getSelectedIds:function(){var e=this,t=[];return this.selectedByIndex.forEach(function(n,i){n&&t.push(e.rows[i].id)}),t}},computed:{actionsColumnWidth:function(){return{width:this.actions.reduce(function(e,t){return(t.width?t.width:70)+e},0)+"px"}}}},r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{key:JSON.stringify(e.rows),class:e.getContainerClass(),style:e.costmerStyle},[e.msg?n("div",{staticClass:"no-data"},[e._v(e._s(e.msg))]):!e.rows||e.rows.length<=0?n("div",{staticClass:"no-data"},[e._v("Sorry, no data yet.")]):n("table",{staticClass:"basic-table"},[n("thead",[n("tr",{staticClass:"title"},[n("th",{staticClass:"selected-column"},[n("el-checkbox",{staticClass:"select",on:{change:e.allSelectedChange}})],1),e._v(" "),e._l(e.columns,function(t,i){return n("th",{key:i},[e._v(e._s(t.text))])}),e._v(" "),e.actions&&e.actions.length>0?n("th",{style:e.actionsColumnWidth},[e._v("操作")]):e._e()],2)]),e._v(" "),n("tbody",e._l(e.rows,function(t,i){return n("tr",{key:i,staticClass:"row"},[n("td",{staticClass:"selected-column"},[n("el-checkbox",{staticClass:"select",model:{value:e.selectedByIndex[i],callback:function(t){e.$set(e.selectedByIndex,i,t)},expression:"selectedByIndex[rindex]"}})],1),e._v(" "),e._l(e.columns,function(i,r){return n("td",{key:r,style:i.style?i.style(t.enabled):""},[e._v(e._s(i.render?i.render(t[i.dataIndex]):t[i.dataIndex]))])}),e._v(" "),e.actions&&e.actions.length>0?n("td",e._l(e.actions,function(i,r){return n("el-button",{key:r,attrs:{size:"small",type:"primary"},on:{click:function(e){i.handleClick(t)}}},[e._v(e._s(i.text))])}),1):e._e()],2)}),0)])])},staticRenderFns:[]};var s=n("VU/8")(i,r,!1,function(e){n("UeeO")},null,null);t.a=s.exports},"9vv2":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("8xfg"),r=n("lk5p"),s={props:{itemKey:String,title:String,arrayData:Array,selectedIds:Array,actions:Array},data:function(){return{dialogVisible:!1}},methods:{handleYesClick:function(){this.dialogVisible=!1;var e=this.$refs.treeRef.getCheckedNodes().map(function(e){return e.value});this.$emit("onYesClick",e)},toggleSelectAll:function(e){var t=e?this.arrayData.map(function(e){return e.id}):[];this.$refs.treeRef.setCheckedKeys(t)}},computed:{treeData:function(){return Object(r.b)(this.arrayData)},selectedLabels:function(){var e=this;if(this._.isEmpty(this.selectedIds))return"请选择";var t=this.selectedIds;this.selectedIds.length>6&&(t=t.slice(0,6));var n=t.map(function(t){return e._.find(e.arrayData,function(e){return e.id===t}).name});return this.selectedIds.length>6&&n.push("..."),n.join(", ")}}},a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{key:e.itemKey,staticClass:"tree-select-area"},[e.selectedIds&&e.selectedIds.length===e.arrayData.length?n("el-tag",{attrs:{"disable-transitions":!0,type:"success"}},[e._v("已全选")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(t){e.dialogVisible=!0}}},[e._v(e._s(e.selectedLabels))]),e._v(" "),e.selectedIds&&e.selectedIds.length>0?n("el-button",{attrs:{type:"text"},on:{click:function(t){e.$emit("onYesClick",[])}}},[e._v("清空")]):e._e(),e._v(" "),n("el-dialog",{attrs:{center:!0,width:"30%",title:e.title,visible:e.dialogVisible,"append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-row",[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleYesClick}},[e._v("确认")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.toggleSelectAll(!0)}}},[e._v("全选")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.toggleSelectAll(!1)}}},[e._v("全不选")])],1),e._v(" "),n("el-tree",{ref:"treeRef",attrs:{data:e.treeData,"node-key":"value","check-strictly":!0,"show-checkbox":!0,"default-checked-keys":e.selectedIds,"default-expand-all":"","expand-on-click-node":!1}})],1)],1)},staticRenderFns:[]};var l=n("VU/8")(s,a,!1,function(e){n("k/aY")},null,null).exports,o=n("Zz1P"),c=n.n(o),d={components:{Table:i.a,TreeSelectArea:l},created:function(){window.ListService.get(this.listUrl,{vm:this}).then(this.handleListDataReceived)},data:function(){return{currentPage:1,pageSize:50,total:650,formLabelWidth:"200px",dtoFormVisible:!1,count:0,currentDto:{},rules:{name:[{required:!0,message:"请输入角色名",trigger:"change"},{min:2,max:16,message:"长度在 2 到 16 个字符",trigger:"change"}],rights:[{required:!0,message:"请选择权限",trigger:"change"}]},currentIndex:-1,dtoColumns:[{text:"角色名",dataIndex:"name"},{text:"添加日期",dataIndex:"created",render:function(e){return c()(e).format("YYYY-MM-DD")}},{text:"启用",dataIndex:"enabled",render:function(e){return e?"启用":"禁用"},style:function(e){return{color:e?"blue":"red"}}}],loadingMsg:"",listData:[]}},methods:{handleSubmitClick:function(e,t){var n=this,i=this;this.$refs.ruleForm.validate(function(e){if(!e)return n.$message({message:"请处理完错误后再保存",type:"error"}),!1;i.currentDto.id?window.ActionService.post("/api/role/update",n.currentDto,{successMsg:"保存成功",errorMsg:"保存失败"}).then(function(e){i.listData.splice(i.currentIndex,1,i.currentDto),i.dtoFormVisible=!1}):window.ActionService.post("/api/role/insert",i.currentDto,{successMsg:"添加成功",errorMsg:"添加失败"}).then(function(e){i.dtoFormVisible=!1,i.currentPage=1,window.ListService.get(i.listUrl,{vm:n}).then(i.handleListDataReceived)})})},handlePageSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.isLoading=!0,window.ListService.get(this.listUrl,{vm:this}).then(this.handleListDataReceived)},handleListDataReceived:function(e){this.listData=e.rows,this.currentPage=e.page,this.pageSize=e.pageSize,this.total=e.total},handlePageChange:function(e){this.currentPage=e,this.isLoading=!0,window.ListService.get(this.listUrl,{vm:this}).then(this.handleListDataReceived)},showAddingForm:function(){this.dtoFormVisible=!0,this.currentDto={}},handleToggleEnableClick:function(e){var t=this.$refs.table.getSelectedIds();if(this._.isEmpty(t))return this.$message({message:"请先勾选要"+(e?"启":"禁")+"用的角色",type:"error"}),!1;var n=t.map(function(e){return'"'+e+'"'}).join(","),i="/api/role/"+(e?"enable":"disable");window.ToggleEnableAndAlert(this,i,n,null,e)},handleRightsSelected:function(e){this.$set(this.currentDto,"rights",e)},getPageButtonFunc:function(e){switch(e){case"role/insert":return this.showAddingForm();case"role/enable":return this.handleToggleEnableClick(!0);case"role/disable":return this.handleToggleEnableClick(!1)}},getItemButtonFunc:function(e){var t=this;switch(e){case"role/update":return function(e){t.currentDto=t._.assign({},e),t.dtoFormVisible=!0,t.currentIndex=t._.findIndex(t.listData,function(n){return t._.isEqual(n,e)})};case"role/enable":return this.getToggleEnableAndAlertFunc(t,!0);case"role/disable":return this.getToggleEnableAndAlertFunc(t,!1);case"role/delete":return function(e){var n='/api/role/delete?id="'+e.id+'"';window.HandleDeleteClick(t,n)}}},getToggleEnableAndAlertFunc:function(e,t){return function(n){var i="/api/role/"+(t?"enable":"disable");window.ToggleEnableAndAlert(e,i,'"'+n.id+'"',n,t)}}},computed:{listUrl:function(){return"/api/role/getList?page="+this.currentPage+"&pageSize="+this.pageSize},modalTitle:function(){return this._.isEmpty(this.currentDto)?"添加角色":"编辑角色"},rights:function(){return this.$store.state.openInfo.rights.map(function(e){return e.enabled=!0,e})},pageRights:function(){return Object(r.e)(this.$store,"role")},itemRights:function(){var e=this;return Object(r.d)(this.$store,"role").map(function(t){return{text:t.name,handleClick:e.getItemButtonFunc(t.id)}})},tableContainerHeight:function(){return{height:this._.isEmpty(this.pageRights)?"calc(100% - 212px)":"calc(100% - 270px)"}}}},u={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main-content"},[n("el-breadcrumb",{attrs:{separator:"/"}},[n("el-breadcrumb-item",{staticClass:"other"},[e._v("角色管理")]),e._v(" "),n("el-breadcrumb-item",[e._v("角色列表")])],1),e._v(" "),n("el-row",e._l(e.pageRights,function(t,i){return n("el-button",{key:i,attrs:{type:"primary",size:"small"},on:{click:function(n){e.getPageButtonFunc(t.id)}}},[e._v(e._s(t.name))])}),1),e._v(" "),n("div",{staticClass:"data-content"},[n("Table",{ref:"table",attrs:{msg:e.loadingMsg,rows:e.listData,columns:e.dtoColumns,actions:e.itemRights,costmerStyle:e.tableContainerHeight}}),e._v(" "),n("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handlePageSizeChange,"current-change":e.handlePageChange}})],1),e._v(" "),n("el-dialog",{attrs:{modal:!1,title:e.modalTitle,visible:e.dtoFormVisible},on:{"update:visible":function(t){e.dtoFormVisible=t}}},[n("el-form",{ref:"ruleForm",attrs:{model:e.currentDto,rules:e.rules}},[n("el-form-item",{attrs:{label:"角色名","label-width":e.formLabelWidth,prop:"name"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.currentDto.name,callback:function(t){e.$set(e.currentDto,"name",t)},expression:"currentDto.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"权限","label-width":e.formLabelWidth,prop:"rights"}},[n("TreeSelectArea",{attrs:{itemKey:e.currentDto.id,title:"请选择权限",arrayData:e.rights,selectedIds:e.currentDto.rights},on:{onYesClick:e.handleRightsSelected}})],1),e._v(" "),n("el-form-item",{attrs:{label:"","label-width":e.formLabelWidth,prop:"enabled"}},[n("el-checkbox",{model:{value:e.currentDto.enabled,callback:function(t){e.$set(e.currentDto,"enabled",t)},expression:"currentDto.enabled"}},[e._v("启用")])],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmitClick}},[e._v("确定")]),e._v(" "),n("el-button",{on:{click:function(t){e.dtoFormVisible=!1}}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var h=n("VU/8")(d,u,!1,function(e){n("w8Ie")},null,null);t.default=h.exports},UeeO:function(e,t){},"k/aY":function(e,t){},w8Ie:function(e,t){}});